<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="This package provides a simple and efficient implementation of difference-in-differences estimation that scales to big data.">
<title>A Big Data Implementation of Difference-in-differences Estimation with Staggered Treatment • DiDforBigData</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A Big Data Implementation of Difference-in-differences Estimation with Staggered Treatment">
<meta property="og:description" content="This package provides a simple and efficient implementation of difference-in-differences estimation that scales to big data.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">DiDforBigData</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="articles/DiDforBigData.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/Examples.html">Examples</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/setzler/DiDforBigData/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="did-for-big-data-in-r">DiD for Big Data in R<a class="anchor" aria-label="anchor" href="#did-for-big-data-in-r"></a>
</h1></div>
<p>This R package provides a big-data-friendly and memory-efficient difference-in-differences (DiD) estimator for staggered (and non-staggered) treatment contexts. It supports controlling for time-varying covariates, heteroskedasticity-robust standard errors, and (single and multi-way) clustered standard errors. See <a href="https://jonathandroth.github.io/assets/files/DiD_Review_Paper.pdf" class="external-link">Roth, Sant’Anna, Bilinksi, and Poe (2022)</a> for background on staggered DiD.</p>
<div class="section level2">
<h2 id="id_1-why-do-we-need-a-staggered-did-package-for-big-data">1. Why do we need a staggered DiD package for big data?<a class="anchor" aria-label="anchor" href="#id_1-why-do-we-need-a-staggered-did-package-for-big-data"></a>
</h2>
<p>Recently, I noticed a pattern at seminars and conferences: presenters would acknowledge that they <em>should</em> use a staggered DiD estimator in their context. However, they could not implement staggered DiD due to the sample size being too large for existing software.</p>
<p>To verify that large sample size is an issue with existing software, I wrote a simple panel data simulator with staggered treatment roll-out and heterogeneous treatment effects. I simulated it with different numbers of individuals and applied the available R packages that implement the methods of:</p>
<ul>
<li>
<code>didimputation</code> for implementing the approach of <a href="https://www.xavierjaravel.com/_files/ugd/bacd2d_ebf772e1b7ea4a178a060e6ebfcfa056.pdf" class="external-link">Borusyak, Jaravel, and Spiess (2022)</a>;</li>
<li>
<code>did</code> for implementing the approach of <a href="https://psantanna.com/files/Callaway_SantAnna_2020.pdf" class="external-link">Callaway &amp; Sant’Anna (2021)</a>; and</li>
<li>
<code>DIDmultiplegt</code> for implementing the approach of <a href="https://drive.google.com/file/d/1D93ltJUirR4zIqJZfSTwSLrA-6rSZpTJ/view" class="external-link">de Chaisemartin &amp; D’Haultfoeuille (2020)</a>.</li>
</ul>
<p>I found that only <code>did</code> could successfully estimate staggered DiD with 100,000 unique individuals, and it took a while. While many DiD applications consider only a small number of unique individuals (e.g. state-level analysis with 50 states), DiD designs at the household-level or firm-level using administrative data often involve millions of unique individuals.</p>
</div>
<div class="section level2">
<h2 id="id_2-this-package">2. This package<a class="anchor" aria-label="anchor" href="#id_2-this-package"></a>
</h2>
<p>I wrote <code>DiDforBigData</code> to address 4 issues that arise in the context of large administrative datasets:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Speed:</strong> In less than 1 minute, <code>DiDforBigData</code> will provide estimation and inference for staggered DiD with millions of observations on a personal laptop. It is orders of magnitude faster than other available software if the sample size is large.</li>
<li>
<strong>Memory:</strong> Administrative data is often stored on crowded servers with limited memory available for researchers to use. <code>DiDforBigData</code> helps by using much less memory than other software.</li>
<li>
<strong>Dependencies:</strong> Administrative servers often do not have outside internet access, making it difficult to install dependencies. This package has only <em>two</em> dependencies, <code>data.table</code> for big data management and <code>sandwich</code> for robust standard error estimation, which are already installed with most R distributions. Optionally, it will use <code>fixest</code> to speed up the estimation if available.</li>
<li>
<strong>Parallelization:</strong> Administrative servers often have a large number of available processors, but each processor may be slow, so it is important to parallelize. <code>DiDforBigData</code> makes parallelization trivial as long as the <code>parallel</code> package is installed.</li>
</ol>
</div>
<div class="section level2">
<h2 id="id_3-demonstration">3. Demonstration<a class="anchor" aria-label="anchor" href="#id_3-demonstration"></a>
</h2>
<p>This section will compare the following implementations of DiD estimators for staggered treatment contexts:</p>
<ol style="list-style-type: decimal">
<li>The implementation of the Borusyak, Jaravel, and Spiess (2022) approach in R package <code>didimputation</code>;</li>
<li>The implementation of the Callaway &amp; Sant’Anna (2021) approach in R package <code>did</code>;</li>
<li>The implementation of the de Chaisemartin &amp; D’Haultfoeuille (2020) approach in R package <code>DIDmultiplegt</code> using 40 bootstrap draws for standard errors (<code>brep=40</code>); and,</li>
<li>My R package <code>DiDforBigData</code>.</li>
</ol>
<p>Regarding <code>did</code>, there are many options available in this package, so I compare three: the default (doubly-robust); the estimation method <code>est_method = "reg"</code> (not shown below since it gives nearly identical results to the default); and the case in which standard errors are computed analytically rather than by bootstrap (<code>bstrap=F</code>).</p>
<p>Below, I draw the simulated data 3 times per sample size, and apply each estimator. Results are presented for the median across those 3 draws. Sample Size refers to the number of unique individuals. Since there are 10 simulated years of data, and the sample is balanced across years, the number of observations is 10 times the number of unique individuals.</p>
<div class="section level3">
<h3 id="id_31-point-estimates">3.1 Point estimates<a class="anchor" aria-label="anchor" href="#id_31-point-estimates"></a>
</h3>
<p>I verify that all of the estimators provide similar point estimates and standard errors. Here, I show the point estimates and 95% confidence intervals (using +/- 1.96*SE) for the DiD estimate at event time +1 (averaging across cohorts). The true ATT is 4 at event time +1. I also verify that two-way fixed-effects OLS estimation would find an effect of about 5.5 at event time +1 when the sample is large.</p>
<p><img src="https://github.com/setzler/DiDforBigData/raw/main/vignettes/estimates_small.png"></p>
<p>A caveat: The Callaway and Sant’Anna (2021) estimators provide standard errors that correspond to <em>multiple-hypothesis testing</em> and will thus tend to be wider. My package provides the usual single-hypothesis testing, consistent with the standard errors usually reported on regression coefficients.</p>
</div>
<div class="section level3">
<h3 id="id_32-speed-test">3.2 Speed test<a class="anchor" aria-label="anchor" href="#id_32-speed-test"></a>
</h3>
<p><strong>Small Samples:</strong> Here is the run-time required to complete the DiD estimation using each package:</p>
<p><img src="https://github.com/setzler/DiDforBigData/raw/main/vignettes/speedtest_small.png"></p>
<p>We see that, with 20,000 unique individuals, <code>didimpute</code> and <code>DIDmultiplegt</code> have become very slow. I could not get either approach to run successfully with 100,000 unique individuals, as they both crash R. By contrast, <code>did</code> and <code>DiDforBigData</code> are so fast that they can barely be seen in the plot.</p>
<p><strong>Large samples:</strong> Given the failure of <code>didimpute</code> and <code>DIDmultiplegt</code> with 100,000 observations, we now restrict attention to <code>did</code> and <code>DiDforBigData</code>. We consider much larger samples:</p>
<p><img src="https://github.com/setzler/DiDforBigData/raw/main/vignettes/speedtest_large.png"></p>
<p>Even with 1 million unique individuals (and 10 million observations), it is difficult to see <code>DiDforBigData</code> in the plot, as estimation requires about half of a minute, versus nearly 1 hour for <code>did</code>. Thus, <code>DiDforBigData</code> is roughly <em>two orders of magnitude</em> faster than <code>did</code> when working with a sample of one million individuals.</p>
</div>
<div class="section level3">
<h3 id="id_33-memory-test">3.3 Memory test<a class="anchor" aria-label="anchor" href="#id_33-memory-test"></a>
</h3>
<p><strong>Small Samples:</strong> Here is the memory used to complete the DiD estimation by each package:</p>
<p><img src="https://github.com/setzler/DiDforBigData/raw/main/vignettes/memorytest_small.png"></p>
<p>We see that <code>DIDmultiplegt</code> uses much more memory than the other approaches. The other approaches all use relatively little memory at these sample sizes.</p>
<p><strong>Large Samples:</strong></p>
<p><img src="https://github.com/setzler/DiDforBigData/raw/main/vignettes/memorytest_large.png"></p>
<p>When considering large samples, we see that <code>DiDforBigData</code> uses less than half of the memory used by <code>did</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="id_4-getting-started">4. Getting Started<a class="anchor" aria-label="anchor" href="#id_4-getting-started"></a>
</h2>
<p>To install the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"setzler/DiDforBigData"</span><span class="op">)</span></span></code></pre></div>
<p>To use the package after it is installed:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/setzler/DiDforBigData" class="external-link">DiDforBigData</a></span><span class="op">)</span></span></code></pre></div>
<p>Set up your list of variable names. Here is an example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varnames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">varnames</span><span class="op">$</span><span class="va">time_name</span> <span class="op">=</span> <span class="st">"year"</span> </span>
<span><span class="va">varnames</span><span class="op">$</span><span class="va">outcome_name</span> <span class="op">=</span> <span class="st">"Y"</span></span>
<span><span class="va">varnames</span><span class="op">$</span><span class="va">cohort_name</span> <span class="op">=</span> <span class="st">"cohort"</span></span>
<span><span class="va">varnames</span><span class="op">$</span><span class="va">id_name</span> <span class="op">=</span> <span class="st">"id"</span></span></code></pre></div>
<p>To estimate DiD for a single cohort and event time, use the <code>DiDge</code> command. For example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/DiDge.html">DiDge</a></span><span class="op">(</span>inputdata <span class="op">=</span> <span class="va">yourdata</span>, varnames <span class="op">=</span> <span class="va">varnames</span>, </span>
<span>             cohort_time <span class="op">=</span> <span class="fl">2010</span>, event_postperiod <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>A detailed manual explaining the various features available in <code>DiDge</code> is available when you run:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">DiDge</span></span></code></pre></div>
<p>To estimate DiD for a many cohorts and event times, use the <code>DiD</code> command. For example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/DiD.html">DiD</a></span><span class="op">(</span>inputdata <span class="op">=</span> <span class="va">yourdata</span>, varnames <span class="op">=</span> <span class="va">varnames</span>, </span>
<span>    min_event <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>, max_event <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>A detailed manual explaining the various features available in <code>DiD</code> is available when you run:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">DiD</span></span></code></pre></div>
<p>Use the links at the top of this page for more information on Getting Started, or see the article called Examples for detailed examples of the capabilities of the commands.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/setzler/DiDforBigData/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/setzler/DiDforBigData/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> </small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing DiDforBigData</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Bradley Setzler <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bradley Setzler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
